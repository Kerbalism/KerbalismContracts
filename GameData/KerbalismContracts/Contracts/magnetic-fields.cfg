CONTRACT_TYPE
{
	name = Kerbalism_ResearchMagneticFields
	title = Research the magnetic field of @/targetBodyValid1
	genericTitle = Research magnetic field
	group = Kerbalism
	agent = Kerbalism
	description = Investigate the magnetic field of @/targetBodyValid1. For best results, the orbit should have high inclination and eccentricity.
	genericDescription = Research the magnetic field of the targeted celestial body.
	synopsis = Research the magnetic field of @/targetBodyValid1.
	completedMessage = Mission Success! Magnetic field researched.

	sortKey = 100

	cancellable = true
	declinable = true
	autoAccept = false
	minExpiry = 0
	maxExpiry = 0
	maxCompletions = 0
	maxSimultaneous = 5

	targetBody = @/targetBodyValid1

	autoAccept = true

	prestige = Significant
	advanceFunds = 4000
	rewardFunds = @advanceFunds * 4
	rewardScience = 1
	rewardReputation = 1
	failureReputation = 2
	failureFunds = @advanceFunds * 0.5

	DATA_EXPAND
	{
		type             = CelestialBody
		targetBody1      = @Kerbalism:radiationBodies
	}

	DATA
	{
		title            = Is not already offered
		type             = CelestialBody
		requiredValue    = true
		uniquenessCheck  = CONTRACT_ALL
		targetBodyValid1 = @/targetBody1
	}

	REQUIREMENT
	{
		name = FlyBy
		type = FlyBy
	}

	REQUIREMENT
	{
		name = DidResearchKerbin
		type = CompleteContract
		contractType = Kerbalism_ResearchMagneticField_Kerbin
	}


	// --------------------------------------------------
  // -- INNER BELT ------------------------------------
	// --------------------------------------------------

	PARAMETER
	{
	  name = RadiationSensor
	  type = PartValidation
	  title = Have a radiation sensor
	  hideChildren = true

	  FILTER
	  {
	    MODULE
	    {
	      name = Sensor
	      type = radiation
	    }
	  }
	}

	PARAMETER
	{
		name = InnerBelt
		type = VesselParameterGroup
		title = Research the inner radiation belt
		hideChildren = true

		PARAMETER
		{
			name = HasInnerFieldOrBust
			type = Any

			PARAMETER
		  {
		    name = RadiationField
		    type = RadiationField
				field = INNER_BELT
		    crossings_min = 5

				rewardFunds = 5000
				rewardScience = 3
				rewardReputation = 3
		  }

			PARAMETER
			{
				name = StayLongEnoughToFindNoField
				type = All

				PARAMETER
			  {
			    name = HasNoRadiationField
			    type = HasNoRadiationField
					field = INNER_BELT
			  }

				PARAMETER
				{
					name = OrbitInner
					type = Orbit
					maxPeA = @targetBody.Radius() * 3
				}

				PARAMETER
				{
					name = Duration
					type = Duration
					duration = 3d
					preWaitText = Maintain orbit
					preWaitText = Maintain orbit
					preWaitText = Research done
					startCriteria = PARAMETER_COMPLETION
					parameter = OrbitInner
				}
			}
		}
	}

	// --------------------------------------------------
  // -- OUTER BELT ------------------------------------
	// --------------------------------------------------

	PARAMETER
	{
		name = OuterBelt
		type = VesselParameterGroup
		title = Research the outer radiation belt
		hideChildren = true

		PARAMETER
		{
			name = HasOuterFieldOrBust
			type = Any

			PARAMETER
		  {
		    name = RadiationField
		    type = RadiationField
				field = OUTER_BELT
		    crossings_min = 5

				rewardFunds = 4000
				rewardScience = 2
				rewardReputation = 2
		  }

			PARAMETER
			{
				name = StayLongEnoughToFindNoField
				type = All

				PARAMETER
			  {
			    name = HasNoRadiationField
			    type = HasNoRadiationField
					field = OUTER_BELT
			  }

				PARAMETER
				{
					name = OrbitOuter
					type = Orbit
					minApA = @targetBody.Radius() * 5
				}

				PARAMETER
				{
					name = Duration
					type = Duration
					duration = 4d
					preWaitText = Maintain orbit
					preWaitText = Maintain orbit
					preWaitText = Research done
					startCriteria = PARAMETER_COMPLETION
					parameter = OrbitOuter
				}
			}
		}
	}

	// --------------------------------------------------
	// -- MAGNETOSPHERE ---------------------------------
	// --------------------------------------------------

	PARAMETER
	{
		name = Magnetosphere
		type = VesselParameterGroup
		title = Research the magnetosphere
		hideChildren = true

		PARAMETER
		{
			name = HasMagnetosphereFieldOrBust
			type = Any

			PARAMETER
			{
				name = RadiationField
				type = RadiationField
				field = MAGNETOPAUSE
				crossings_min = 5

				rewardFunds = 3000
				rewardScience = 1
				rewardReputation = 1
			}

			PARAMETER
			{
				name = StayLongEnoughToFindNoField
				type = All

				PARAMETER
				{
					name = HasNoRadiationField
					type = HasNoRadiationField
					field = MAGNETOPAUSE
				}

				PARAMETER
				{
					name = OrbitPause
					type = Orbit
					minEccentricity = 0.2
				}

				PARAMETER
				{
					name = Duration
					type = Duration
					duration = 5d
					preWaitText = Maintain orbit
					preWaitText = Maintain orbit
					preWaitText = Research done
					startCriteria = PARAMETER_COMPLETION
					parameter = OrbitPause
				}
			}
		}

		PARAMETER
		{
			name = CollectScience
			type = CollectScience
			title = Transmit radiation scan
			experiment = geigerCounter
			completeInSequence = true
			hideChildren = true
		}
	}

	BEHAVIOUR
	{
		name = ShowBelt
		type = ShowRadiationField
		field = INNER_BELT
	}

	BEHAVIOUR
	{
		name = ShowBelt
		type = ShowRadiationField
		field = OUTER_BELT
	}

	BEHAVIOUR
	{
		name = ShowBelt
		type = ShowRadiationField
		field = MAGNETOPAUSE
	}
}
