CONTRACT_TYPE
{
	name = Kerbalism_ResearchMagneticField
	title = Research the magnetic field of @/targetBodyValid1
	genericTitle = Research magnetic field
	group = Kerbalism
	agent = Kerbalism
	description = Investigate the magnetic field of @/targetBodyValid1. For best results, the orbit should have high inclination and eccentricity.
	genericDescription = Research the magnetic field of the targeted celestial body.
	synopsis = Research the magnetic field of @/targetBodyValid1.
	completedMessage = Mission Success! Magnetic field researched.

	sortKey = 100

	cancellable = true
	declinable = true
	autoAccept = false
	minExpiry = 0
	maxExpiry = 0
	maxCompletions = 0
	maxSimultaneous = 5
	deadline = 365 * ( @/targetBodyValid1.Multiplier() / 2.5 )

	targetBody = @/targetBodyValid1

	prestige = Significant
	advanceFunds = 4000
	rewardFunds = @advanceFunds * 4
	rewardScience = 1
	rewardReputation = 1
	failureReputation = 2
	failureFunds = @advanceFunds * 0.5

	DATA_EXPAND
	{
		type             = CelestialBody
		targetBody1      = @Kerbalism:radiationBodies
	}

	DATA
	{
		title            = Is not already offered
		type             = CelestialBody
		requiredValue    = true
		uniquenessCheck  = CONTRACT_ALL
		targetBodyValid1 = @/targetBody1
	}

	REQUIREMENT
	{
		name = FlyBy
		type = FlyBy
	}

	// --------------------------------------------------
  // -- INNER BELT ------------------------------------
	// --------------------------------------------------

	PARAMETER
	{
	  name = RadiationSensor
	  type = PartValidation
	  title = Have a radiation sensor
	  hideChildren = true

	  FILTER
	  {
	    MODULE
	    {
	      name = Sensor
	      type = radiation
	    }
	  }
	}

	PARAMETER
	{
		name = InnerBelt
		type = VesselParameterGroup
		title = Research the inner radiation belt
		hideChildren = false // TODO set this to true

		PARAMETER
		{
			name = HasInnerFieldOrBust
			type = Any

			PARAMETER
		  {
		    name = RadiationField
		    type = RadiationField
				field = INNER_BELT
		    crossings_min = 5
		  }

			PARAMETER
			{
				name = StayLongEnoughToFindNoField
				type = All

				PARAMETER
			  {
			    name = HasNoRadiationField
			    type = HasNoRadiationField
					field = INNER_BELT
			  }

				PARAMETER
				{
					name = OrbitInner
					type = Orbit
					minAltitude = @targetBody.Radius()
				}

				PARAMETER
				{
					name = Timer
					type = Timer
					duration = 30d
					timerType = PARAMETER_COMPLETION
					parameter = OrbitInner
					failContract = false
				}
			}
		}

		PARAMETER
	  {
	    name = CanTransmitScience
	    type = CanTransmitScience
	    title = Can transmit science
			completeInSequence = true

			rewardFunds = 5000
			rewardScience = 3
			rewardReputation = 3
	  }

		BEHAVIOUR
		{
			name = ShowBelt
			type = ShowRadiationField
			field = INNER_BELT
		}
	}

	// --------------------------------------------------
  // -- OUTER BELT ------------------------------------
	// --------------------------------------------------

	PARAMETER
	{
		name = OuterBelt
		type = VesselParameterGroup
		title = Research the outer radiation belt
		hideChildren = false // TODO set this to true

		PARAMETER
		{
			name = HasOuterFieldOrBust
			type = Any

			PARAMETER
		  {
		    name = RadiationField
		    type = RadiationField
				field = OUTER_BELT
		    crossings_min = 5
		  }

			PARAMETER
			{
				name = StayLongEnoughToFindNoField
				type = All

				PARAMETER
			  {
			    name = HasNoRadiationField
			    type = HasNoRadiationField
					field = OUTER_BELT
			  }

				PARAMETER
				{
					name = OrbitOuter
					type = Orbit
					minAltitude = @targetBody.Radius() * 5
				}

				PARAMETER
				{
					name = Timer
					type = Timer
					duration = 30d
					timerType = PARAMETER_COMPLETION
					parameter = OrbitOuter
					failContract = false
				}
			}
		}

		PARAMETER
	  {
	    name = CanTransmitScience
	    type = CanTransmitScience
	    title = Can transmit science
			completeInSequence = true

			rewardFunds = 4000
			rewardScience = 2
			rewardReputation = 2
	  }

		BEHAVIOUR
		{
			name = ShowBelt
			type = ShowRadiationField
			field = OUTER_BELT
		}
	}

	// --------------------------------------------------
	// -- MAGNETOSPHERE ---------------------------------
	// --------------------------------------------------

	PARAMETER
	{
		name = Magnetosphere
		type = VesselParameterGroup
		title = Research the magnetosphere
		hideChildren = false // TODO set this to true

		PARAMETER
		{
			name = HasMagnetosphereFieldOrBust
			type = Any

			PARAMETER
			{
				name = RadiationField
				type = RadiationField
				field = MAGNETOPAUSE
				crossings_min = 5
			}

			PARAMETER
			{
				name = StayLongEnoughToFindNoField
				type = All

				PARAMETER
				{
					name = HasNoRadiationField
					type = HasNoRadiationField
					field = MAGNETOPAUSE
				}

				PARAMETER
				{
					name = OrbitPause
					type = Orbit
					minAltitude = @targetBody.Radius() * 11
				}

				PARAMETER
				{
					name = Timer
					type = Timer
					duration = 30d
					timerType = PARAMETER_COMPLETION
					parameter = OrbitPause
					failContract = false
				}
			}
		}

		PARAMETER
		{
			name = CanTransmitScience
			type = CanTransmitScience
			title = Can transmit science
			completeInSequence = true

			rewardFunds = 3000
			rewardScience = 1
			rewardReputation = 1
		}

		BEHAVIOUR
		{
			name = ShowBelt
			type = ShowRadiationField
			field = MAGNETOPAUSE
		}
	}
}
