CONTRACT_TYPE:NEEDS[Kerbalism,FeatureRadiation]
{
  failureFunds = 5000
  rewardFunds = 10000
  advanceFunds = 15000

  name = KerbalismResearchMagneticField
  agent = Kerbalism
  group = Kerbalism
  title = Research the magnetic field of BODY
  genericTitle = Research a magnetic field
  description = Research the magnetic field of BODY
  synopsis = We don't know enough about the magnetic field of BODY. Send a probe to BODY and search for a magnetopause and radiation belts.
  completedMessage = Magnetic field of BODY is researched.
  minExpiry = 0.0
  maxExpiry = 0.0
  deadline = 0.0
  prestige = Significant
  maxCompletions = 1
  maxSimultaneous = 5
  rewardScience = 15
  rewardReputation = 15
  failureReputation = 5

  // this works
  targetBody = Kerbin

  // this does not work
  // targetBody = @/targetBody1

  DATA_EXPAND
  {
      type = CelestialBody
      targetBody1 = AllBodies().Where(cb => !cb.IsSun())
  }

  REQUIREMENT
  {
    name = FlyBy
    type = FlyBy
  }

  PARAMETER
  {
    name = CompleteContract
    type = VesselParameterGroup
    title = Research the magnetic field of @targetBody
    targetBody = Kerbin

    PARAMETER
    {
      name = RadiationSensor
      type = PartValidation
      title = Have a radiation sensor
      hideChildren = true

      FILTER
      {
        MODULE
        {
          name = Sensor
          type = radiation
        }
      }
    }

    PARAMETER
    {
      name = InnerBelt
      type = InnerBelt
      crossings = 5
    }

    PARAMETER
    {
      name = OuterBelt
      type = OuterBelt
      crossings = 5
    }

    PARAMETER
    {
      name = Magnetopause
      type = Magnetopause
      crossings = 4
    }

    // TODO: vessel is connected

  }

  BEHAVIOUR
  {
    name = RevealInnerBelt
    type = RevealInnerBelt
  }

  BEHAVIOUR
  {
    name = RevealOuterBelt
    type = RevealOuterBelt
  }

  BEHAVIOUR
  {
    name = RevealMagnetopause
    type = RevealMagnetopause
  }
}
