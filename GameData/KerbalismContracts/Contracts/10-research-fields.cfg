CONTRACT_TYPE:NEEDS[Kerbalism,FeatureRadiation]
{
  failureFunds = @Kerbalism:Kerbucks1
  rewardFunds = @Kerbalism:Kerbucks2
  advanceFunds = @Kerbalism:Kerbucks3

  name = KerbalismResearchMagneticField
  agent = Kerbalism
  group = Kerbalism
  title = Research the magnetic field of $targetBody
  genericTitle = Research a magnetic field
  description = Research the magnetic field of $targetBody
  synopsis = We don't know enough about the magnetic field of $targetBody. Send a probe to @targetBody and search for a magnetopause and radiation belts.
  completedMessage = Magnetic field of $targetBody is researched.
  minExpiry = 0.0
  maxExpiry = 0.0
  deadline = 0.0
  prestige = Significant
  maxCompletions = 1
  maxSimultaneous = 5
  rewardScience = 15
  rewardReputation = 15
  failureReputation = 5

  DATA
  {
      title = The Celestial Bodies
      type = List<CelestialBody>
      requiredValue = false
      targetBodyValid1 = AllBodies().Where(cb => !cb.IsSun())
  }

  DATA_EXPAND
  {
      type = CelestialBody
      targetBody = @targetBodyValid1
  }

  REQUIREMENT
  {
    name = FlyBy
    type = FlyBy
  }

  PARAMETER
  {
    name = CompleteContract
    type = VesselParameterGroup
    title = Research the magnetic field of @targetBody
    targetBody = Kerbin

    PARAMETER
    {
      name = RadiationSensor
      type = PartValidation
      title = Have a radiation sensor
      hideChildren = true

      FILTER
      {
        MODULE
        {
          name = Sensor
          type = radiation
        }
      }
    }

    PARAMETER
    {
      name = InnerBelt
      type = InnerBelt
      crossings = 5
    }

    PARAMETER
    {
      name = OuterBelt
      type = OuterBelt
      crossings = 5
    }

    PARAMETER
    {
      name = Magnetopause
      type = Magnetopause
      crossings = 4
    }

    // TODO: vessel is connected

  }

  BEHAVIOUR
  {
    name = RevealInnerBelt
    type = RevealInnerBelt
  }

  BEHAVIOUR
  {
    name = RevealOuterBelt
    type = RevealOuterBelt
  }

  BEHAVIOUR
  {
    name = RevealMagnetopause
    type = RevealMagnetopause
  }
}
